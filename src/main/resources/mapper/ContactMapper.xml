<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.greatgump.crm.mapper.ContactMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.greatgump.crm.entity.Contact">
        <id column="id" property="id" />
        <result column="contact_name" property="contactName" />
        <result column="mail" property="mail" />
        <result column="phone" property="phone" />
        <result column="qq" property="qq" />
        <result column="department" property="department" />
        <result column="wechat" property="wechat" />
        <result column="is_default" property="isDefault" />
        <result column="customer_id" property="customerId" />
        <result column="remark" property="remark" />
        <result column="is_delete" property="isDelete" />
    </resultMap>
    <resultMap id="contactDto" type="com.greatgump.crm.dto.ContactDto">
        <id column="id" property="id" />
        <result column="customerName" property="contactName" />
        <result column="contact_name" property="contactName" />
        <result column="mail" property="mail" />
        <result column="phone" property="phone" />
        <result column="qq" property="qq" />
        <result column="department" property="department" />
        <result column="wechat" property="wechat" />

    </resultMap>
    <insert id="saveContact">
        insert into t_contact( contact_name, mail, phone, qq, department, wechat, customer_id,is_default, is_delete)
        values(#{contactName},#{mail},#{phone},#{qq},#{department},#{wechat},#{customerId},#{isDefault},0)
    </insert>


    <select id="queryAllContact" resultMap="contactDto">
        SELECT tc.id, tc.contact_name, tc.mail, tc.phone, tc.qq, tc.department, tc.wechat,tcs.customer_name
        FROM t_contact tc,t_customer tcs WHERE tc.is_delete = 0 AND tc.is_default = 1 AND tc.customer_id = tcs.id
    </select>
    <select id="queryDefByCustomerIdContact" resultType="com.greatgump.crm.entity.Contact">
        select id, contact_name, mail, phone, qq, department, wechat
        from t_contact where is_delete = 0 and is_default = 1 and customer_id = #{cid}
    </select>

</mapper>
